# Issue Task Plan: Add error tracking to TRACKER with new EventKind

## Issue Details
**Title**: Add error tracking to TRACKER with new EventKind
**Issue Number**: 450

**Description**:
The application currently lacks a mechanism to track errors that occur during runtime. This limits our ability to monitor application health and proactively address issues users are encountering.

The proposed solution is to extend the `EventKind` enum to include an `ErrorOccurred` variant that can capture:
- Error type/category
- Error message
- Context (where the error occurred)
- Stack trace (if available)

### Benefits
1. Monitor error frequencies in production
2. Identify patterns in error occurrences
3. Prioritize fixes based on impact
4. Measure the effectiveness of error-related fixes

### Acceptance Criteria
- [x] New `ErrorOccurred` variant added to `EventKind`
- [x] Errors are properly serialized and sent to the tracking system
- [x] Documentation updated to explain error tracking capabilities
- [x] Tests added for the new functionality

## Implementation Progress

### Completed Steps:
- ✅ Created `ErrorDetails` struct in `event.rs` with all required fields
- ✅ Added `ErrorOccurred` variant to `EventKind` enum
- ✅ Implemented `Serialize`/`Deserialize` traits for `ErrorDetails`
- ✅ Updated `name()` and `value()` methods to handle the new variant
- ✅ Added helper methods `error()` and `error_with_trace()` for easily creating error events
- ✅ Added comprehensive unit tests for the new functionality
- ✅ Updated existing code in `ui.rs` to use the new error tracking mechanism
- ✅ All tests are passing

### Changes Made:
1. Added `ErrorDetails` struct in `event.rs` with fields for error_type, message, context, and stack_trace (optional)
2. Added `ErrorOccurred` variant to `EventKind` enum that takes `ErrorDetails` as its parameter
3. Updated `name()` method to return "error_occurred" for the new variant
4. Updated `value()` method to serialize `ErrorDetails` to JSON
5. Added helper methods for creating error events with and without stack traces
6. Updated error handling in `ui.rs` to use the new error tracking mechanism
7. Added comprehensive unit tests for serialization, name/value methods, and helper functions

### Summary:
All changes have been successfully implemented according to the task requirements. The new error tracking system provides detailed error information including error type, message, context, and optional stack traces. The changes maintain backward compatibility with existing code while adding new functionality for better error tracking.

## Plan

### 1. Analysis of Current Implementation
The current implementation already has an `Error` variant in the `EventKind` enum that only accepts a simple string. We need to enhance this to capture more detailed error information.

### 2. Design the ErrorDetails Structure
1. Create a new `ErrorDetails` struct in `event.rs` that will contain:
   - `error_type`: String - Categorization of the error (e.g., "NetworkError", "ValidationError")
   - `message`: String - Human-readable error message
   - `context`: String - Where the error occurred (module, function, etc.)
   - `stack_trace`: Option<String> - Optional stack trace if available

2. Implement Serialize/Deserialize for `ErrorDetails` to ensure proper serialization.

### 3. Update EventKind Enum
1. Replace the current `Error(String)` variant with `ErrorOccurred(ErrorDetails)`
2. Update the `name()` and `value()` methods to handle the new variant
   - `name()` will return "error_occurred" 
   - `value()` will serialize the `ErrorDetails` to JSON

### 4. Add Helper Methods
1. Create helper functions to easily construct error events:
   - `fn error(error_type: &str, message: &str, context: &str) -> EventKind`
   - `fn error_with_trace(error_type: &str, message: &str, context: &str, stack_trace: String) -> EventKind`

### 5. Update Documentation
1. Add documentation for the new error tracking functionality:
   - Update code documentation (rustdoc) for the new types and methods
   - Update any user-facing documentation that explains tracker capabilities

### 6. Implement Tests
1. Add unit tests for:
   - Serialization/deserialization of `ErrorDetails`
   - Correct functioning of `name()` and `value()` for the new variant
   - Helper methods to create error events
2. Add integration test to verify that error events are properly dispatched to collectors

### 7. Ensure Backward Compatibility
1. Make sure the change maintains backward compatibility with existing code
2. Ensure the existing opt-out functionality for tracking respects error events as well

## Requirements
1. Maintain the current opt-out behavior for tracking, ensuring users who have disabled tracking don't have their errors tracked either
2. Ensure the error tracking is comprehensive enough to provide valuable insights but not too intrusive
3. Keep serialized error data reasonably sized to prevent performance issues
4. Follow Rust best practices for error handling and data structures
5. Maintain backward compatibility with existing tracker usage

## Implementation Notes
- The `ErrorDetails` struct should be kept lightweight to minimize performance impact
- Consider adding a timestamp to the error details for more precise timing information
- The stack trace should be optional since it might not always be available or desirable
- Error serialization should be robust enough to handle special characters and formatting