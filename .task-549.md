# Task Plan for Issue #549: Implement a `/agents` Command

## Issue Details

**Title**: feat: implement a `/agents` command  
**State**: OPEN  
**Author**: amitksingh1490  
**Labels**: forge-automate  
**Issue Number**: 549  

**Description**:
- Should show agent details such as tools, events it has subscribed to, and the model.
- Agents should be read from the active workflow.
- Display should be optimized for terminal with good looking ANSI color codes.
- Refer to `/info` implementation for colors.

## Plan

### 1. Research and Exploration (COMPLETED)

✅ Examined the command structure and how the CLI system works in Forge
✅ Understood how the `/info` command is implemented for UI/UX patterns
✅ Identified how workflow and agent information is stored and accessed
✅ Analyzed the data structures for Agent, including tools, events and models
✅ Explored the terminal display utilities and ANSI color code implementation

### 2. Implementation Tasks

The implementation will require modifications to the following files:

#### A. Add the `/agents` command to the Command enum
- [ ] **File**: `/crates/forge_main/src/model.rs`  
- [ ] Add a new variant `Agents` to the `Command` enum alongside other commands
- [ ] Update the `name()` method to return "/agents" for this command
- [ ] Update the `usage()` method to return an appropriate description
- [ ] Add the command to the match arms in the `parse()` method

#### B. Update the ForgeCommandManager to include the new command
- [ ] **File**: `/crates/forge_main/src/model.rs`
- [ ] In the `default_commands()` function, ensure the new `Agents` command is included

#### C. Implement the Information Display Structure
- [ ] **File**: Create a function in an appropriate location (either in UI or in a dedicated file) to handle agent display
- [ ] Consider adding a helper method/struct to structure agent information for formatting

#### D. Add Command Handling to UI
- [ ] **File**: `/crates/forge_main/src/ui.rs`
- [ ] Add a new match arm for `Command::Agents` in the main command processing loop
- [ ] Implement logic to:
  - Access the active workflow
  - Extract agent information
  - Format and display the information to the console
  - Return to command prompt

### 3. Implementation Details

#### A. Accessing Agent Information
To access agent information, we need to:
- [ ] Get the active workflow from the current conversation
- [ ] Extract the list of agents from the workflow
- [ ] For each agent, retrieve:
  - Agent ID/name
  - Model (if specified)
  - Tool list
  - Event subscription list
  - Description (if available)

#### B. Information Display Format
The display should follow these formatting rules:
- [ ] Use bold, bright yellow for section titles (similar to `/info`)
- [ ] Display agent names prominently
- [ ] Use dimmed text for details
- [ ] For each agent, show:
  - Agent ID/name (prominently displayed)
  - Model name (if specified)
  - Description (if available)
  - Tools (formatted as a list)
  - Events subscribed to (formatted as a list)

#### C. Error Handling
Add appropriate error handling for:
- [ ] When no workflow is active
- [ ] When the workflow contains no agents
- [ ] When agent information is incomplete

### 4. Code Implementation Approach

#### Adding the Command:
```rust
// In model.rs Command enum
pub enum Command {
    // Existing commands...
    Agents,
    // ...
}

// In the name() method
match self {
    // ...
    Command::Agents => "/agents",
    // ...
}

// In the usage() method
match self {
    // ...
    Command::Agents => "Display information about agents in the active workflow",
    // ...
}

// In the parse() method
match trimmed {
    // ...
    "/agents" => Ok(Command::Agents),
    // ...
}
```

#### UI Handler Implementation (Pseudocode):
```rust
// In ui.rs
match input {
    // ...
    Command::Agents => {
        // Check if a conversation and workflow exist
        if let Some(conversation_id) = self.state.conversation_id.clone() {
            // Get the conversation (which contains workflow)
            if let Some(conversation) = self.api.conversation(&conversation_id).await? {
                // The workflow contains agents
                if let Some(workflow) = conversation.workflow {
                    let agents = workflow.agents;
                    
                    // Create display information
                    let mut info = Info::new().add_title("Agents");
                    
                    if agents.is_empty() {
                        info = info.add_key_value("Status", "No agents found in active workflow");
                    } else {
                        // For each agent, add information
                        for agent in agents {
                            // Format agent information (model, tools, events, etc.)
                            // Add to info structure
                        }
                    }
                    
                    // Display the info
                    CONSOLE.writeln(info.to_string())?;
                }
            }
        } else {
            // No active conversation
            CONSOLE.writeln(
                TitleFormat::failed("No active workflow")
                    .sub_title("Start a conversation first")
                    .format(),
            )?;
        }
        
        let prompt_input = Some((&self.state).into());
        input = self.console.prompt(prompt_input).await?;
        continue;
    }
    // ...
}
```

### 5. Testing Strategy

#### Manual Testing:
- [ ] Test with a workflow with no agents
- [ ] Test with a workflow containing a single agent
- [ ] Test with a workflow containing multiple agents
- [ ] Test with agents having different combinations of:
  - Models
  - Tools
  - Event subscriptions
- [ ] Test display formatting in different terminal sizes
- [ ] Test error handling scenarios

### 6. Implementation Order

1. [ ] Add the new command to the `Command` enum
2. [ ] Update the command parsing logic
3. [ ] Implement the basic agent information display logic
4. [ ] Add error handling
5. [ ] Format the output with appropriate styling
6. [ ] Test the command with various workflows

## Requirements

### Functional Requirements
1. Command must display all agents from the active workflow
2. For each agent, show:
   - Agent name/ID
   - Associated model (if specified)
   - Available tools (if specified)
   - Subscribed events (if specified)
   - Description (if available)
3. Output must be formatted with ANSI color codes for better readability
4. Layout should be optimized for terminal viewing
5. Command should handle cases where no workflow is active or no agents exist

### Technical Requirements
1. Follow the existing command implementation patterns
2. Utilize the existing Info struct and color utilities similar to `/info` command
3. Ensure proper error handling for edge cases
4. Maintain clean code structure and organization

### Acceptance Criteria
1. User can run `/agents` command to see a list of all agents in the active workflow
2. Information displayed is complete and matches what's defined in the workflow
3. Terminal output is well-formatted with appropriate use of ANSI colors
4. Command responds appropriately to error conditions
5. Command follows the same design patterns as other built-in commands

## Verification Steps
To verify this feature works correctly:
1. [ ] Load a workflow with multiple agents
2. [ ] Run the `/agents` command
3. [ ] Verify all agents are displayed with correct information
4. [ ] Verify that the display includes:
   - Agent IDs
   - Models (if specified)
   - Tools (if specified) 
   - Event subscriptions (if specified)
5. [ ] Verify that the display is formatted similarly to the `/info` command
6. [ ] Try running without an active workflow and verify proper error handling