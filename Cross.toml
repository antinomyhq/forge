[build]
# Build the build script in the container to avoid GLIBC mismatch
build-std = false
default-target = "x86_64-unknown-linux-gnu"

[build.env]
passthrough = [
    "APP_VERSION",
    "POSTHOG_API_SECRET",
]

# Install protoc in all Cross containers
[target.x86_64-unknown-linux-musl]
pre-build = [
    "apt-get update",
    "apt-get install -y protobuf-compiler",
]

[target.aarch64-unknown-linux-musl]
pre-build = [
    "apt-get update",
    "apt-get install -y protobuf-compiler",
]

[target.aarch64-unknown-linux-gnu]
pre-build = [
    "apt-get update",
    "apt-get install -y protobuf-compiler",
]

[target.aarch64-linux-android]
image = "ghcr.io/cross-rs/aarch64-linux-android:edge"
pre-build = [
    "apt-get update",
    "apt-get install -y protobuf-compiler",
]
