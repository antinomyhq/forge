variables:
  models:
    advanced_model: &advanced_model anthropic/claude-3.7-sonnet
    standard_model: &standard_model anthropic/claude-3.5-haiku

commands:
  - name: verify_prd
    description: Initiates the PRD verification workflow
    value: |
      Start the PRD verification process for the specified feature. The PRD should be provided as a file path.

agents:
  - id: orchestrator
    model: *advanced_model
    ephemeral: false
    tool_supported: true
    system_prompt: "{{> system-prompt-prd-orchestrator.hbs }}"
    user_prompt: |
      {{#if (eq event.name "verify_prd")}}
      <task>Start the PRD verification process with the following request: {{event.value}}</task>
      {{else if (eq event.name "checklist_created")}}
      <task>Received checklist from Requirements Analyzer:
      {{event.value}}

      ACTION REQUIRED: Dispatch "verify_task" event to Verification Agent with the next unchecked item from the checklist.
      </task>
      {{else if (eq event.name "verification_result")}}
      <task>Received verification result:
      {{event.value}}

      ACTION REQUIRED: Check if there are more items in the checklist. If yes, dispatch "verify_task" with the next item. If no, generate final report.
      </task>
      {{else if (eq event.name "user_task_update")}}
      <task>User has provided feedback: {{event.value}}</task>
      {{else}}
      <task>{{event.value}}</task>
      {{/if}}
    tools:
      - tool_forge_fs_read
      - tool_forge_fs_search
      - tool_forge_event_dispatch
      - tool_forge_display_show_user
      - tool_forge_process_think
    subscribe:
      - verify_prd
      - user_task_update
      - checklist_created
      - verification_result

  - id: requirements_analyzer_worker
    model: *advanced_model
    ephemeral: false
    tool_supported: true
    system_prompt: "{{> system-prompt-prd-analyzer.hbs }}"
    user_prompt: |
      {{#if (eq event.name "analyze_prd")}}
      <task>Analyze the following PRD and create a verification checklist:
      {{event.value}}
      </task>
      {{else if (eq event.name "update_checklist")}}
      <task>Update the verification checklist based on the following feedback:
      {{event.value}}
      </task>
      {{else}}
      <task>{{event.value}}</task>
      {{/if}}
    tools:
      - tool_forge_event_dispatch
    subscribe:
      - analyze_prd
      - update_checklist

  - id: verification_agent_worker
    model: *advanced_model
    ephemeral: false
    tool_supported: true
    system_prompt: "{{> system-prompt-prd-verifier.hbs }}"
    user_prompt: |
      {{#if (eq event.name "verify_task")}}
      <task>Verify the following requirement against the implementation:
      {{event.value}}
      </task>
      {{else}}
      <task>{{event.value}}</task>
      {{/if}}
    tools:
      - tool_forge_fs_read
      - tool_forge_fs_search
      - tool_forge_process_shell
      - tool_forge_event_dispatch
      - tool_forge_process_think
    subscribe:
      - verify_task 