variables:
  models:
    advanced_model: &advanced_model anthropic/claude-3.7-sonnet
    standard_model: &standard_model anthropic/claude-3.5-haiku

commands:
  - name: verify_prd
    description: Initiates the PRD verification workflow
    value: |
      Start the PRD verification process for the specified feature. The PRD should be provided as a file path.

  - name: update_checklist
    description: Update the verification checklist based on feedback
    value: |
      Update the verification checklist with the following feedback.

  - name: analyze_prd
    description: Analyzes the PRD to create a verification checklist
    value: |
      Analyze the PRD to create a comprehensive verification checklist.
      
  - name: verify_task
    description: Verifies a specific requirement against the implementation
    value: |
      Verify that this requirement has been properly implemented.
      
  - name: checklist_created
    description: Handle newly created checklists
    value: |
      Review this checklist and present it to the user for validation.
      
  - name: verification_result
    description: Process verification results
    value: |
      Process these verification results and determine next steps.
      
  - name: verification_complete
    description: Completes the verification process
    value: |
      The verification process is now complete. Generate a final report.

agents:
  - id: orchestrator
    model: *advanced_model
    ephemeral: false
    tool_supported: true
    system_prompt: "{{> system-prompt-prd-orchestrator.hbs }}"
    user_prompt: |
      {{#if (eq event.name "verify_prd")}}
      <task>Start the PRD verification process with the following request: {{event.value}}</task>
      {{else if (eq event.name "checklist_created")}}
      <task>Review the following checklist and present it to the user for validation:
      {{event.value}}
      </task>
      {{else if (eq event.name "verification_result")}}
      <task>Process the following verification result and decide on next steps:
      {{event.value}}
      </task>
      {{else if (eq event.name "user_task_update")}}
      <task>User has provided feedback: {{event.value}}</task>
      {{else if (eq event.name "verification_complete")}}
      <task>Generate a final verification report based on all completed tasks.</task>
      {{else}}
      <task>{{event.value}}</task>
      {{/if}}
    tools:
      - tool_forge_fs_read
      - tool_forge_fs_search
      - tool_forge_event_dispatch
      - tool_forge_display_show_user
      - tool_forge_process_think
    subscribe:
      - verify_prd
      - user_task_update
      - checklist_created
      - verification_result
      - verification_complete

  - id: requirements_analyzer
    model: *advanced_model
    ephemeral: false
    tool_supported: true
    system_prompt: "{{> system-prompt-prd-analyzer.hbs }}"
    user_prompt: |
      {{#if (eq event.name "analyze_prd")}}
      <task>Analyze the following PRD and create a verification checklist:
      {{event.value}}
      </task>
      {{else if (eq event.name "update_checklist")}}
      <task>Update the verification checklist based on the following feedback:
      {{event.value}}
      </task>
      {{else}}
      <task>{{event.value}}</task>
      {{/if}}
    tools:
      - tool_forge_fs_read
      - tool_forge_fs_search
      - tool_forge_event_dispatch
      - tool_forge_process_think
    subscribe:
      - analyze_prd
      - update_checklist

  - id: verification_agent
    model: *advanced_model
    ephemeral: false
    tool_supported: true
    system_prompt: "{{> system-prompt-prd-verifier.hbs }}"
    user_prompt: |
      {{#if (eq event.name "verify_task")}}
      <task>Verify the following requirement against the implementation:
      {{event.value}}
      </task>
      {{else}}
      <task>{{event.value}}</task>
      {{/if}}
    tools:
      - tool_forge_fs_read
      - tool_forge_fs_search
      - tool_forge_process_shell
      - tool_forge_event_dispatch
      - tool_forge_process_think
    subscribe:
      - verify_task 